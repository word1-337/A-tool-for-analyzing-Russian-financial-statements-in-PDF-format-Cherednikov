# Агент анализа финансовой устойчивости

Инструмент для анализа российской бухгалтерской отчётности (баланс, ОФР, ОДДС) в формате PDF:

- извлекает таблицы с помощью MinerU;
- считает ключевые коэффициенты финансовой устойчивости;
- оценивает динамику (темпы прироста по строкам отчётности);
- рассчитывает интегральный индекс финансовой устойчивости (0..1);
- предоставляет веб-интерфейс на Streamlit;
- опционально даёт текстовый вывод через Ollama (модель qwen2.5:32b).

## Структура проекта

```
agent.py          — единый файл: backend (MinerU, расчёты) + веб-интерфейс
requirements.txt  — зависимости
results/          — готовые .txt-отчёты (создаётся автоматически)
```

---

## Установка

### Шаг 1 — Python

Скачай **Python 3.11** строго с [python.org](https://www.python.org/downloads/release/python-3119/) → `Windows installer (64-bit)`.

> **Не используй Python из Microsoft Store** — он устанавливает пакеты в путь длиной ~120 символов,
> что вызывает `OSError` при установке MinerU (у него длинные внутренние пути).

При установке **обязательно** поставь галочку **"Add Python to PATH"**.

Проверь в новом терминале:
```
python --version
```
Должно быть `Python 3.11.x`.

### Шаг 2 — положи проект в короткий путь

Распакуй или склонируй репозиторий в **корень диска**, например:

```
C:\proj\
```

Итоговый путь к файлу должен быть коротким: `C:\proj\agent.py`.

> Если проект лежит в `C:\Users\...\Downloads\...`, установка может упасть с ошибкой
> `OSError: No such file or directory` из-за ограничения Windows в 260 символов.

### Шаг 3 — установи зависимости

Открой терминал в папке `C:\proj\` и выполни:

```
python -m pip install -r requirements.txt
```

Установка занимает 5–15 минут (скачивается ~2 ГБ пакетов).

### Шаг 4 — запуск

```
python -m streamlit run agent.py
```

Браузер откроется на `http://localhost:8501`.

> При **первом анализе PDF** MinerU автоматически скачивает ML-модели (~5 ГБ).
> Это происходит один раз. Нужен интернет и место на диске.

---

## Настройка Ollama (опционально)

Для работы кнопок «Краткий вывод ИИ» и «Спросить ИИ»:

1. Установи Ollama: https://ollama.com/download
2. Скачай модель:
   ```
   ollama pull qwen2.5:32b
   ```

> `qwen2.5:32b` весит ~20 ГБ и требует 32+ ГБ ОЗУ.
> На слабых машинах замени на `qwen2.5:7b` — в `agent.py` найди все строки
> `model="qwen2.5:32b"` и замени на `model="qwen2.5:7b"`.

---

## Частые проблемы при установке

### `OSError: No such file or directory` при `pip install`

**Причина:** Python из Microsoft Store устанавливает пакеты в слишком длинный путь,
либо проект лежит глубоко в папках.

**Решение 1 (рекомендуется):** переустанови Python с [python.org](https://www.python.org/downloads/release/python-3119/) и положи проект в `C:\proj\`.

**Решение 2 (если есть права администратора):** включить поддержку длинных путей:
```powershell
Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem' -Name 'LongPathsEnabled' -Value 1
```

---

### `pip` не распознан / `streamlit` не найден

**Причина:** папка Scripts не добавлена в PATH (частая проблема с Microsoft Store Python).

**Решение:** всегда используй `python -m` вместо прямых команд:
```
python -m pip install -r requirements.txt
python -m streamlit run agent.py
```

---

### `WARNING: ... is not on PATH`

Это предупреждение, **не ошибка**. Установка продолжается. Просто используй `python -m streamlit` для запуска.

---

### `ModuleNotFoundError: No module named 'torch'`

MinerU требует PyTorch, но не всегда устанавливает его автоматически.

```
python -m pip install torch torchvision
```

---

### `ModuleNotFoundError: No module named 'doclayout_yolo'` (или другой модуль MinerU)

MinerU в pipeline-режиме требует дополнительные пакеты. Установи extras:

```
python -m pip install "mineru[pipeline]"
```

---

### Установка упала в середине

pip сохраняет прогресс. Просто повтори команду — продолжит с того места:

```
python -m pip install -r requirements.txt
```

---

### Python 3.12 / 3.13 — ошибки при установке MinerU

MinerU несовместим с Python 3.12+. Используй строго **Python 3.11**.

---

### MinerU скачивает модели очень долго

Нормально при первом запуске (~5 ГБ). Не закрывай браузер и дождись завершения.

---

### Ollama не отвечает

Убедись что сервис запущен:
```
ollama serve
```
Если Ollama установлена, она запускается автоматически. Попробуй перезапустить.
